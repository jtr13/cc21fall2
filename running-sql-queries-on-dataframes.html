<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 98 Running Sql Queries on Dataframes | EDAV Fall 2021 Tues/Thurs Community Contributions</title>
<meta name="description" content="Chao Pang and Krishna Kalluri library(tidyverse) library(openintro) library(sparklyr)  98.1 Motivation The goal of this tutorial is to allow ourselves and other students to have the capability to...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 98 Running Sql Queries on Dataframes | EDAV Fall 2021 Tues/Thurs Community Contributions">
<meta property="og:type" content="book">
<meta property="og:description" content="Chao Pang and Krishna Kalluri library(tidyverse) library(openintro) library(sparklyr)  98.1 Motivation The goal of this tutorial is to allow ourselves and other students to have the capability to...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 98 Running Sql Queries on Dataframes | EDAV Fall 2021 Tues/Thurs Community Contributions">
<meta name="twitter:description" content="Chao Pang and Krishna Kalluri library(tidyverse) library(openintro) library(sparklyr)  98.1 Motivation The goal of this tutorial is to allow ourselves and other students to have the capability to...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/forceNetwork-binding-0.4/forceNetwork.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet">
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script><script src="libs/dygraphs-1.1.1/shapes.js"></script><script src="libs/moment-2.8.4/moment.js"></script><script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script><script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script><script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-8.1.2/highcharts.js"></script><script src="libs/highcharts-8.1.2/highcharts-3d.js"></script><script src="libs/highcharts-8.1.2/highcharts-more.js"></script><script src="libs/highcharts-8.1.2/modules/stock.js"></script><script src="libs/highcharts-8.1.2/modules/map.js"></script><script src="libs/highcharts-8.1.2/modules/annotations.js"></script><script src="libs/highcharts-8.1.2/modules/data.js"></script><script src="libs/highcharts-8.1.2/modules/drilldown.js"></script><script src="libs/highcharts-8.1.2/modules/item-series.js"></script><script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script><script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-8.1.2/modules/exporting.js"></script><script src="libs/highcharts-8.1.2/modules/export-data.js"></script><script src="libs/highcharts-8.1.2/modules/funnel.js"></script><script src="libs/highcharts-8.1.2/modules/heatmap.js"></script><script src="libs/highcharts-8.1.2/modules/treemap.js"></script><script src="libs/highcharts-8.1.2/modules/sankey.js"></script><script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script><script src="libs/highcharts-8.1.2/modules/organization.js"></script><script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script><script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script><script src="libs/highcharts-8.1.2/modules/sunburst.js"></script><script src="libs/highcharts-8.1.2/modules/vector.js"></script><script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script><script src="libs/highcharts-8.1.2/modules/xrange.js"></script><script src="libs/highcharts-8.1.2/modules/tilemap.js"></script><script src="libs/highcharts-8.1.2/modules/venn.js"></script><script src="libs/highcharts-8.1.2/modules/gantt.js"></script><script src="libs/highcharts-8.1.2/modules/timeline.js"></script><script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script><script src="libs/highcharts-8.1.2/modules/bullet.js"></script><script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script><script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script><script src="libs/highcharts-8.1.2/modules/lollipop.js"></script><script src="libs/highcharts-8.1.2/modules/series-label.js"></script><script src="libs/highcharts-8.1.2/plugins/motion.js"></script><script src="libs/highcharts-8.1.2/custom/reset.js"></script><script src="libs/highcharts-8.1.2/modules/boost.js"></script><script src="libs/highchart-binding-0.8.2/highchart.js"></script><script src="libs/detect-resize-0.5.3/jquery.resize.js"></script><link href="libs/jquery-ui-1.11.4/jquery-ui.min.css" rel="stylesheet">
<script src="libs/jquery-ui-1.11.4/jquery-ui.min.js"></script><script src="libs/vega-1.4.3/vega.min.js"></script><script src="libs/lodash-2.2.1/lodash.min.js"></script><script>var lodash = _.noConflict();</script><link href="libs/ggvis-0.4.7/css/ggvis.css" rel="stylesheet">
<script src="libs/ggvis-0.4.7/js/ggvis.js"></script><link href="libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet">
<script src="libs/wordcloud2-0.0.1/wordcloud2-all.js"></script><script src="libs/wordcloud2-0.0.1/hover.js"></script><script src="libs/wordcloud2-binding-0.2.1/wordcloud2.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">EDAV Fall 2021 Tues/Thurs Community Contributions</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome!</a></li>
<li><a class="" href="community-contribution.html"><span class="header-section-number">2</span> Community Contribution</a></li>
<li><a class="" href="github-submission-instructions.html"><span class="header-section-number">3</span> GitHub submission instructions</a></li>
<li><a class="" href="sample-project.html"><span class="header-section-number">4</span> Sample project</a></li>
<li class="book-part">Cheatsheets</li>
<li><a class="" href="statistics-in-r-vs-python.html"><span class="header-section-number">5</span> Statistics in R vs Python</a></li>
<li><a class="" href="data-visualization-with-seaborn.html"><span class="header-section-number">6</span> Data Visualization with Seaborn</a></li>
<li><a class="" href="how-to-make-your-own-r-package.html"><span class="header-section-number">7</span> How to Make Your Own R package</a></li>
<li><a class="" href="rchess-package-cheatsheet.html"><span class="header-section-number">8</span> RChess package cheatsheet</a></li>
<li><a class="" href="hypothesis-testing-cheatsheet.html"><span class="header-section-number">9</span> Hypothesis testing cheatsheet</a></li>
<li><a class="" href="interactive-web-visualizations-for-r-cheatsheet.html"><span class="header-section-number">10</span> Interactive web visualizations for R cheatsheet"</a></li>
<li><a class="" href="ggforce.html"><span class="header-section-number">11</span> ggforce</a></li>
<li><a class="" href="gganimate-cheatsheet.html"><span class="header-section-number">12</span> GGanimate cheatsheet</a></li>
<li><a class="" href="statistical-tests-and-parameter-estimations-in-r-cheatsheet.html"><span class="header-section-number">13</span> Statistical Tests and Parameter Estimations in R Cheatsheet</a></li>
<li><a class="" href="ggalluvial-cheat-sheet.html"><span class="header-section-number">14</span> ggalluvial-cheat-sheet</a></li>
<li><a class="" href="introduction-to-plotly.html"><span class="header-section-number">15</span> Introduction to plotly</a></li>
<li><a class="" href="draw-graphs-using-python-and-r.html"><span class="header-section-number">16</span> draw graphs using python and R</a></li>
<li><a class="" href="data-visualization-packages-in-r.html"><span class="header-section-number">17</span> Data Visualization Packages in R</a></li>
<li><a class="" href="esquisse-cheat-sheet.html"><span class="header-section-number">18</span> Esquisse Cheat sheet</a></li>
<li><a class="" href="review-sheet-for-r-code-and-data-transformation.html"><span class="header-section-number">19</span> review sheet for r code and data transformation</a></li>
<li><a class="" href="scrape-twitter-data-using-r.html"><span class="header-section-number">20</span> Scrape Twitter data using R</a></li>
<li><a class="" href="r-note-and-mathematics-in-rmd-cheatsheet.html"><span class="header-section-number">21</span> R note and Mathematics in Rmd cheatsheet</a></li>
<li><a class="" href="textbook-notes.html"><span class="header-section-number">22</span> Textbook Notes</a></li>
<li><a class="" href="ggplot2-cheatsheet.html"><span class="header-section-number">23</span> ggplot2 cheatsheet</a></li>
<li><a class="" href="rstudio-cheatsheet.html"><span class="header-section-number">24</span> RStudio Cheatsheet</a></li>
<li><a class="" href="d3-visualization-in-r-cheatsheet.html"><span class="header-section-number">25</span> D3 Visualization in R Cheatsheet</a></li>
<li><a class="" href="colors.html"><span class="header-section-number">26</span> Colors</a></li>
<li><a class="" href="r-data-sets.html"><span class="header-section-number">27</span> R data sets</a></li>
<li><a class="" href="introduction-to-plotly-1.html"><span class="header-section-number">28</span> ‚ÄúIntroduction to Plotly‚Äù</a></li>
<li><a class="" href="tidyverse-cheatsheet.html"><span class="header-section-number">29</span> Tidyverse Cheatsheet</a></li>
<li><a class="" href="learning-sql-with-its-r-dplyr-translation.html"><span class="header-section-number">30</span> Learning SQL with Its R dplyr Translation</a></li>
<li><a class="" href="animate-time-series-the-goyav-package.html"><span class="header-section-number">31</span> Animate Time Series : the goyav package</a></li>
<li><a class="" href="string-manipulation-in-r.html"><span class="header-section-number">32</span> String Manipulation in R</a></li>
<li><a class="" href="ggalluvial-cheatsheet.html"><span class="header-section-number">33</span> ggalluvial Cheatsheet</a></li>
<li><a class="" href="a-cheatsheet-from-pandas-to-base-r-and-tidyverse.html"><span class="header-section-number">34</span> A cheatsheet from pandas to base r and tidyverse</a></li>
<li><a class="" href="base-r-ggplot2-python-graphing-performances.html"><span class="header-section-number">35</span> Base R, ggplot2, &amp; Python Graphing Performances</a></li>
<li><a class="" href="cheat-sheet-to-score-100-points.html"><span class="header-section-number">36</span> Cheat Sheet to Score 100 Points</a></li>
<li><a class="" href="base-r-string-operations-cheatsheet.html"><span class="header-section-number">37</span> Base R String Operations Cheatsheet</a></li>
<li><a class="" href="data-manipulation-in-r.html"><span class="header-section-number">38</span> Data manipulation in R</a></li>
<li><a class="" href="ggplot_matplotlib_cheatsheet.html"><span class="header-section-number">39</span> ggplot_matplotlib_cheatsheet</a></li>
<li><a class="" href="introduction-to-log-transformation.html"><span class="header-section-number">40</span> Introduction to Log-transformation</a></li>
<li class="book-part">Tutorials</li>
<li><a class="" href="how-to-integrate-r-with-postgresql.html"><span class="header-section-number">41</span> How to Integrate R with PostgreSQL</a></li>
<li><a class="" href="tutorial-on-cluster-analysis.html"><span class="header-section-number">42</span> Tutorial on Cluster Analysis</a></li>
<li><a class="" href="apply-function-in-r.html"><span class="header-section-number">43</span> Apply function in r</a></li>
<li><a class="" href="introduction-to-interactive-graphs-in-r.html"><span class="header-section-number">44</span> Introduction to interactive graphs in R</a></li>
<li><a class="" href="plot-and-analyze-stock-data-with-r.html"><span class="header-section-number">45</span> Plot and Analyze Stock Data with R</a></li>
<li><a class="" href="data-visulization-ordering.html"><span class="header-section-number">46</span> Data Visulization Ordering</a></li>
<li><a class="" href="tutorial-on-lattice-package-in-r.html"><span class="header-section-number">47</span> Tutorial on lattice package in R</a></li>
<li><a class="" href="network-visualization-in-r.html"><span class="header-section-number">48</span> Network Visualization in R</a></li>
<li><a class="" href="dplyr-tutorial-in-r.html"><span class="header-section-number">49</span> Dplyr tutorial in R</a></li>
<li><a class="" href="downloading-files.html"><span class="header-section-number">50</span> Downloading files</a></li>
<li><a class="" href="video-introduction-to-maps-with-ggmap.html"><span class="header-section-number">51</span> Video introduction to maps with ggmap</a></li>
<li><a class="" href="comparison-among-base-r-tidyverse-and-datatable.html"><span class="header-section-number">52</span> Comparison among base R, tidyverse, and datatable</a></li>
<li><a class="" href="raincloud-plot-101-density-plot-or-boxplotwhy-not-do-both.html"><span class="header-section-number">53</span> Raincloud plot 101: density plot or boxplotÔºüWhy not do both!</a></li>
<li><a class="" href="an-introduction-to-dygraph-in-r.html"><span class="header-section-number">54</span> An Introduction to Dygraph in R</a></li>
<li><a class="" href="streamlit-tutorial.html"><span class="header-section-number">55</span> Streamlit Tutorial</a></li>
<li><a class="" href="hive-plots-with-the-ggraph-and-hiver-packages.html"><span class="header-section-number">56</span> Hive plots with the ggraph and hiver packages</a></li>
<li><a class="" href="introduction-to-xai-explainable-ai-in-r.html"><span class="header-section-number">57</span> Introduction to XAI (Explainable AI) in R</a></li>
<li><a class="" href="tutorial-for-gg_cleveland.html"><span class="header-section-number">58</span> Tutorial for gg_cleveland</a></li>
<li><a class="" href="neural-network-tools-in-r.html"><span class="header-section-number">59</span> Neural network tools in R</a></li>
<li><a class="" href="r-dplyr-vs-python-pandas.html"><span class="header-section-number">60</span> R Dplyr vs Python Pandas</a></li>
<li><a class="" href="readable-plots.html"><span class="header-section-number">61</span> Readable Plots</a></li>
<li><a class="" href="introduction-to-exploratory-spatial-data-analysis-and-visualization-using-qgis.html"><span class="header-section-number">62</span> Introduction to exploratory spatial data analysis and visualization using QGIS</a></li>
<li><a class="" href="data-visualization-in-python-vs-r.html"><span class="header-section-number">63</span> Data Visualization in Python vs R</a></li>
<li><a class="" href="base-r-tutorial.html"><span class="header-section-number">64</span> Base R Tutorial</a></li>
<li><a class="" href="python-altair-visualization-method-tutorial.html"><span class="header-section-number">65</span> Python Altair Visualization Method Tutorial</a></li>
<li><a class="" href="r-to-python-easy-plot.html"><span class="header-section-number">66</span> R to python easy plot</a></li>
<li><a class="" href="introduction-to-models-and-prediction-evaluation.html"><span class="header-section-number">67</span> Introduction to models and prediction evaluation</a></li>
<li><a class="" href="introduction-to-interactive-time-series-visualizations-with-dygraphs-in-r.html"><span class="header-section-number">68</span> Introduction to Interactive Time Series Visualizations with dygraphs in R</a></li>
<li><a class="" href="integrate-r-with-python.html"><span class="header-section-number">69</span> Integrate R with Python</a></li>
<li><a class="" href="python-visualization-tutorial.html"><span class="header-section-number">70</span> Python Visualization Tutorial</a></li>
<li><a class="" href="gganimate-tutorial.html"><span class="header-section-number">71</span> Gganimate Tutorial</a></li>
<li><a class="" href="get-nba-dataset-in-r.html"><span class="header-section-number">72</span> Get NBA dataset in R</a></li>
<li><a class="" href="mtemplates.html"><span class="header-section-number">73</span> Mtemplates</a></li>
<li><a class="" href="introduction-to-time-series-analysis-in-r.html"><span class="header-section-number">74</span> Introduction to Time Series Analysis in R</a></li>
<li><a class="" href="storytelling-with-data.html"><span class="header-section-number">75</span> Storytelling with Data</a></li>
<li><a class="" href="tutorial-on-r-torch-package.html"><span class="header-section-number">76</span> Tutorial on R torch package</a></li>
<li><a class="" href="edav-tutorials-correlogram-calendar-heatmap-and-slopegram.html"><span class="header-section-number">77</span> EDAV Tutorials: Correlogram, Calendar Heatmap and Slopegram</a></li>
<li><a class="" href="recursive-codes-and-self-organized-map-with-r.html"><span class="header-section-number">78</span> Recursive codes and self-organized map with R</a></li>
<li><a class="" href="tutorial-of-three-ggplot2-based-packages.html"><span class="header-section-number">79</span> Tutorial of three ggplot2 based packages</a></li>
<li><a class="" href="a-step-by-step-tutorial-for-natural-language-processing-in-r.html"><span class="header-section-number">80</span> A Step by Step Tutorial for Natural Language Processing in R</a></li>
<li><a class="" href="tutorial-for-ggvis-and-its-comparison-with-ggplot2.html"><span class="header-section-number">81</span> Tutorial for ggvis and its Comparison with ggplot2</a></li>
<li><a class="" href="feature-selection-in-r.html"><span class="header-section-number">82</span> Feature selection in r</a></li>
<li><a class="" href="debugging-in-rstudio.html"><span class="header-section-number">83</span> Debugging in Rstudio</a></li>
<li><a class="" href="r-tutorial-cheatsheet.html"><span class="header-section-number">84</span> R tutorial cheatsheet</a></li>
<li><a class="" href="brief-introduction-of-ggpubr.html"><span class="header-section-number">85</span> Brief Introduction of ggpubr</a></li>
<li><a class="" href="r-based-data-organization-and-visualization.html"><span class="header-section-number">86</span> R based data organization and visualization</a></li>
<li><a class="" href="r-packages-for-map-visualization.html"><span class="header-section-number">87</span> R packages for map Visualization</a></li>
<li><a class="" href="common-git-command-lines-tutorial-when-working-on-studio.html"><span class="header-section-number">88</span> Common git command lines tutorial when working on studio</a></li>
<li><a class="" href="tutorial-of-radar-chart.html"><span class="header-section-number">89</span> Tutorial of radar chart</a></li>
<li><a class="" href="interactive-radar.html"><span class="header-section-number">90</span> Interactive Radar</a></li>
<li><a class="" href="r-shiny-tutorial.html"><span class="header-section-number">91</span> R shiny tutorial</a></li>
<li><a class="" href="tutorial-on-r-markdown.html"><span class="header-section-number">92</span> Tutorial on R Markdown</a></li>
<li><a class="" href="dlookr-package.html"><span class="header-section-number">93</span> Dlookr package</a></li>
<li><a class="" href="urca-unit-root-test-and-cointegration-test.html"><span class="header-section-number">94</span> Urca: Unit Root Test and Cointegration Test</a></li>
<li><a class="" href="pygal-tutorial.html"><span class="header-section-number">95</span> pygal tutorial</a></li>
<li><a class="" href="comparing-excel-chart-making-with-rs.html"><span class="header-section-number">96</span> Comparing Excel Chart Making with R‚Äôs</a></li>
<li><a class="" href="joining-and-reshaping-in-r.html"><span class="header-section-number">97</span> Joining and reshaping in R</a></li>
<li><a class="active" href="running-sql-queries-on-dataframes.html"><span class="header-section-number">98</span> Running Sql Queries on Dataframes</a></li>
<li><a class="" href="tidyverse.html"><span class="header-section-number">99</span> TidyVerse</a></li>
<li><a class="" href="how-to-animate-your-plots.html"><span class="header-section-number">100</span> How to animate your plots</a></li>
<li><a class="" href="dataframe-operations-tutorial.html"><span class="header-section-number">101</span> Dataframe operations tutorial</a></li>
<li><a class="" href="a-brief-instruction-for-the-half-semester-of-edav5702.html"><span class="header-section-number">102</span> A brief instruction for the half semester of EDAV5702</a></li>
<li><a class="" href="ggplot2-in-python.html"><span class="header-section-number">103</span> ggplot2 in python</a></li>
<li><a class="" href="predictive-analytics-using-data-visualization-in-r.html"><span class="header-section-number">104</span> Predictive Analytics using Data Visualization in R</a></li>
<li><a class="" href="color-selection-for-ggplot-graphs.html"><span class="header-section-number">105</span> Color selection for ggplot graphs</a></li>
<li class="book-part">Project &amp; Workshops</li>
<li><a class="" href="introduction-to-analytics-consulting-at-accenture.html"><span class="header-section-number">106</span> Introduction to analytics consulting at Accenture</a></li>
<li><a class="" href="map-of-the-r-world.html"><span class="header-section-number">107</span> Map of the R world</a></li>
<li><a class="" href="alluvial-diagrams-and-their-implementation-using-ggalluvial-in-r.html"><span class="header-section-number">108</span> Alluvial diagrams and their implementation using GGalluvial in R</a></li>
<li><a class="" href="building-a-dashboard-in-r-for-data-analysis-and-visualization-using-shiny-package.html"><span class="header-section-number">109</span> Building a Dashboard in R for Data Analysis and Visualization using shiny package</a></li>
<li><a class="" href="rgl-package.html"><span class="header-section-number">110</span> RGL Package</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="an-introduction-to-pyecharts-package-in-python.html"><span class="header-section-number">111</span> An introduction to pyecharts package in Python</a></li>
<li><a class="" href="visualization-in-r-v.s.-python.html"><span class="header-section-number">112</span> Visualization in R v.s. Python</a></li>
<li><a class="" href="understand-data-with-plots.html"><span class="header-section-number">113</span> Understand data with plots</a></li>
<li><a class="" href="r-and-python-visualization.html"><span class="header-section-number">114</span> R and Python visualization</a></li>
<li><a class="" href="d-visualization-with-rgl-and-scatterplot3d.html"><span class="header-section-number">115</span> 3D Visualization with rgl and scatterplot3d</a></li>
<li><a class="" href="base-r-vs.-ggplot2-visualization.html"><span class="header-section-number">116</span> Base r vs.¬†ggplot2 visualization</a></li>
<li><a class="" href="improved-density-estimation.html"><span class="header-section-number">117</span> Improved density estimation</a></li>
<li class="book-part">Custom R Package</li>
<li><a class="" href="super-ggformat.html"><span class="header-section-number">118</span> Super ggformat</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="github-initial-setup.html"><span class="header-section-number">119</span> Github initial setup</a></li>
<li><a class="" href="tutorial-for-pull-request-mergers.html"><span class="header-section-number">120</span> Tutorial for pull request mergers</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jtr13/cc21fall2">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="running-sql-queries-on-dataframes" class="section level1">
<h1>
<span class="header-section-number">98</span> Running Sql Queries on Dataframes<a class="anchor" aria-label="anchor" href="#running-sql-queries-on-dataframes"><i class="fas fa-link"></i></a>
</h1>
<p>Chao Pang and Krishna Kalluri</p>
<div class="sourceCode" id="cb1292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://openintrostat.github.io/openintro/">openintro</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://spark.rstudio.com/">sparklyr</a></span><span class="op">)</span></code></pre></div>
<div id="motivation-8" class="section level2">
<h2>
<span class="header-section-number">98.1</span> Motivation<a class="anchor" aria-label="anchor" href="#motivation-8"><i class="fas fa-link"></i></a>
</h2>
<p>The goal of this tutorial is to allow ourselves and other students to have the capability to write SQL queries against dplyr dataframes directly rather than to use dplyr functions in our assignments. Despite the convenience dplyr offers, we actually prefer the beloved classic SQL queries because that‚Äôs what we are using in our daily work. We believe that a lot of people who aren‚Äôt familiar with R (specifically tidyverse) would feel the same way and prefer SQL at the beginning of their adventure into the R ‚Äúuniverse‚Äù.</p>
<p>It‚Äôs important to point out that writing SQL SHOULD not be a complete replacement of dplyr, but rather an alternative option on the table for students because we just feel that one should not limit themselves to a particular data manipulation tool. We do want to acknolwedge that dplyr is a well-thought-out library, it uses the same principles as SQL queries, however, Googling for the right syntax doesn‚Äôt seem to be straightforward at times (unlike pandas for Python). The motivation of this project stemmed from our frustrations of not being able to find the right functions/syntax to manipulate the data with ease. Although we‚Äôve learned how to use dplyr after three assignments, it would be nice to provide this alternative to the future generations of students.</p>
</div>
<div id="sql-use-cases" class="section level2">
<h2>
<span class="header-section-number">98.2</span> SQL use cases<a class="anchor" aria-label="anchor" href="#sql-use-cases"><i class="fas fa-link"></i></a>
</h2>
<div id="get-started" class="section level3">
<h3>
<span class="header-section-number">98.2.1</span> Get started<a class="anchor" aria-label="anchor" href="#get-started"><i class="fas fa-link"></i></a>
</h3>
<p>knitr is the underlying engine for knitting the R markdown files into a document, and provides support for for different programming languages. In particular, knitr provides a SQL engine that allows you write SQL queries in the code chunk, see official documentation at <a href="https://bookdown.org/yihui/rmarkdown/language-engines.html#sql">knitr sql engine</a>. However, this engine requires a connection to a database, and we can only query tables that are materialized in this database. To leverage this engine, we have to create a temp database and import the dataframes of interest as tables. The dbplyer library provides a convenience function to get a in-memory database engine (sqllite) and additional functions for importing dataframes as tables. If you are not familiar with SQL queries and want to learn more about it, please visit this funny tutorial at <a href="https://www.r-bloggers.com/2021/01/learn-how-to-write-sql-from-r/">learn-how-to-write-sql-from-r</a></p>
<div id="load-the-table-into-the-dbplyr-in-mem-database" class="section level4">
<h4>
<span class="header-section-number">98.2.1.1</span> Load the table into the dbplyr in-mem database<a class="anchor" aria-label="anchor" href="#load-the-table-into-the-dbplyr-in-mem-database"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb1293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">connection</span> <span class="op">=</span> <span class="fu">dbplyr</span><span class="fu">::</span><span class="fu"><a href="https://dbplyr.tidyverse.org/reference/memdb_frame.html">src_memdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">con</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/copy_to.html">copy_to</a></span><span class="op">(</span><span class="va">connection</span>, <span class="va">iris</span><span class="op">)</span></code></pre></div>
<p>Wow, this is actually super easy to do, it only took two lines of code to import a table. However, it took us a long time to find out such a function even existed, hopefully you won‚Äôt go through the same pain in the future üòä!</p>
</div>
<div id="run-your-first-query" class="section level4">
<h4>
<span class="header-section-number">98.2.1.2</span> Run your first query<a class="anchor" aria-label="anchor" href="#run-your-first-query"><i class="fas fa-link"></i></a>
</h4>
<p>Once you‚Äôve imported the table, you could get the database connection object from dbplyr directly, now you just need to pass it into the code chunk in the chunk options. There are three options specified in the below code chunk,</p>
<ul>
<li><p>sql: the key word that indicates this is a sql code chunk</p></li>
<li><p>connection: the sqllite database connection we created earlier (any database connection would work though!)</p></li>
</ul>
<div class="sourceCode" id="cb1294"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1294-1"><a href="running-sql-queries-on-dataframes.html#cb1294-1"></a><span class="co">--chunk options: {sql, connection=connection}</span></span>
<span id="cb1294-2"><a href="running-sql-queries-on-dataframes.html#cb1294-2"></a><span class="kw">SELECT</span></span>
<span id="cb1294-3"><a href="running-sql-queries-on-dataframes.html#cb1294-3"></a>  <span class="op">*</span></span>
<span id="cb1294-4"><a href="running-sql-queries-on-dataframes.html#cb1294-4"></a><span class="kw">FROM</span> iris</span></code></pre></div>
</div>
<div id="group-by" class="section level4">
<h4>
<span class="header-section-number">98.2.1.3</span> Group by<a class="anchor" aria-label="anchor" href="#group-by"><i class="fas fa-link"></i></a>
</h4>
<p>Calculate the average petal length, and petal width by species.</p>
<div class="sourceCode" id="cb1295"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1295-1"><a href="running-sql-queries-on-dataframes.html#cb1295-1"></a><span class="co">--chunk options: {sql, connection=connection}</span></span>
<span id="cb1295-2"><a href="running-sql-queries-on-dataframes.html#cb1295-2"></a><span class="kw">SELECT</span></span>
<span id="cb1295-3"><a href="running-sql-queries-on-dataframes.html#cb1295-3"></a>  species,</span>
<span id="cb1295-4"><a href="running-sql-queries-on-dataframes.html#cb1295-4"></a>  <span class="fu">AVG</span>(`Petal.Length`) <span class="kw">AS</span> avg_petal_length,</span>
<span id="cb1295-5"><a href="running-sql-queries-on-dataframes.html#cb1295-5"></a>  <span class="fu">AVG</span>(`Petal.Width`) <span class="kw">AS</span> avg_petal_width</span>
<span id="cb1295-6"><a href="running-sql-queries-on-dataframes.html#cb1295-6"></a><span class="kw">FROM</span> iris</span>
<span id="cb1295-7"><a href="running-sql-queries-on-dataframes.html#cb1295-7"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species </span></code></pre></div>
</div>
<div id="saving-results-as-dataframes" class="section level4">
<h4>
<span class="header-section-number">98.2.1.4</span> Saving results as dataframes<a class="anchor" aria-label="anchor" href="#saving-results-as-dataframes"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb1296"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1296-1"><a href="running-sql-queries-on-dataframes.html#cb1296-1"></a><span class="co">--chunk options: {sql, connection=connection, output.var="result_df"}</span></span>
<span id="cb1296-2"><a href="running-sql-queries-on-dataframes.html#cb1296-2"></a><span class="kw">SELECT</span></span>
<span id="cb1296-3"><a href="running-sql-queries-on-dataframes.html#cb1296-3"></a>  Species <span class="kw">AS</span> specs,</span>
<span id="cb1296-4"><a href="running-sql-queries-on-dataframes.html#cb1296-4"></a>  `Petal.Width` <span class="kw">AS</span> petal_width,</span>
<span id="cb1296-5"><a href="running-sql-queries-on-dataframes.html#cb1296-5"></a>  `Petal.Length` <span class="kw">AS</span> ptal_length</span>
<span id="cb1296-6"><a href="running-sql-queries-on-dataframes.html#cb1296-6"></a><span class="kw">FROM</span> iris</span>
<span id="cb1296-7"><a href="running-sql-queries-on-dataframes.html#cb1296-7"></a><span class="kw">WHERE</span> species <span class="op">=</span> <span class="st">'setosa'</span></span></code></pre></div>
<div class="sourceCode" id="cb1297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result_df</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/paged_table.html">paged_table</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="complex-use-cases" class="section level3">
<h3>
<span class="header-section-number">98.2.2</span> Complex Use Cases<a class="anchor" aria-label="anchor" href="#complex-use-cases"><i class="fas fa-link"></i></a>
</h3>
<div id="popular-pet-names" class="section level5">
<h5>
<span class="header-section-number">98.2.2.0.1</span> Popular pet names<a class="anchor" aria-label="anchor" href="#popular-pet-names"><i class="fas fa-link"></i></a>
</h5>
<p>In this tutorial, are going to use a pet name dataset called <a href="https://www.openintro.org/data/index.php?data=seattlepets">seattlepets</a> for demonstration.The question we are trying to figure out is ‚Äî what are the 20 most popular cat and dog names?</p>
<p>Let‚Äôs try to answer this question using the dplyr way.</p>
<div class="sourceCode" id="cb1298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">seattlepets</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">animal_name</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/filter.html">filter</a></span> <span class="op">(</span><span class="va">species</span> <span class="op"><a href="https://rdrr.io/pkg/raster/man/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Dog"</span>, <span class="st">"Cat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">animal_name</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/mutate.html">mutate</a></span><span class="op">(</span>row_number<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">row_number</span> <span class="op">&lt;=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/paged_table.html">paged_table</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Now let‚Äôs try to write a SQL query that does the same thing.</p>
<div class="sourceCode" id="cb1299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">connection</span> <span class="op">=</span> <span class="fu">dbplyr</span><span class="fu">::</span><span class="fu"><a href="https://dbplyr.tidyverse.org/reference/memdb_frame.html">src_memdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">con</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/copy_to.html">copy_to</a></span><span class="op">(</span><span class="va">connection</span>, <span class="va">seattlepets</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb1300"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1300-1"><a href="running-sql-queries-on-dataframes.html#cb1300-1"></a><span class="co">--chunk options: {sql, connection=connection}</span></span>
<span id="cb1300-2"><a href="running-sql-queries-on-dataframes.html#cb1300-2"></a><span class="kw">WITH</span> pets <span class="kw">AS</span></span>
<span id="cb1300-3"><a href="running-sql-queries-on-dataframes.html#cb1300-3"></a>(</span>
<span id="cb1300-4"><a href="running-sql-queries-on-dataframes.html#cb1300-4"></a>  <span class="kw">SELECT</span></span>
<span id="cb1300-5"><a href="running-sql-queries-on-dataframes.html#cb1300-5"></a>    species, </span>
<span id="cb1300-6"><a href="running-sql-queries-on-dataframes.html#cb1300-6"></a>    animal_name,</span>
<span id="cb1300-7"><a href="running-sql-queries-on-dataframes.html#cb1300-7"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> <span class="fu">count</span></span>
<span id="cb1300-8"><a href="running-sql-queries-on-dataframes.html#cb1300-8"></a>  <span class="kw">FROM</span> seattlepets</span>
<span id="cb1300-9"><a href="running-sql-queries-on-dataframes.html#cb1300-9"></a>  <span class="kw">WHERE</span> animal_name <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb1300-10"><a href="running-sql-queries-on-dataframes.html#cb1300-10"></a>    <span class="kw">AND</span> species <span class="kw">IN</span> (<span class="ot">"Cat"</span>, <span class="ot">"Dog"</span>)</span>
<span id="cb1300-11"><a href="running-sql-queries-on-dataframes.html#cb1300-11"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> species, animal_name</span>
<span id="cb1300-12"><a href="running-sql-queries-on-dataframes.html#cb1300-12"></a>),</span>
<span id="cb1300-13"><a href="running-sql-queries-on-dataframes.html#cb1300-13"></a>animal_name_row_number <span class="kw">AS</span></span>
<span id="cb1300-14"><a href="running-sql-queries-on-dataframes.html#cb1300-14"></a>(</span>
<span id="cb1300-15"><a href="running-sql-queries-on-dataframes.html#cb1300-15"></a>  <span class="kw">SELECT</span></span>
<span id="cb1300-16"><a href="running-sql-queries-on-dataframes.html#cb1300-16"></a>    species,</span>
<span id="cb1300-17"><a href="running-sql-queries-on-dataframes.html#cb1300-17"></a>    animal_name,</span>
<span id="cb1300-18"><a href="running-sql-queries-on-dataframes.html#cb1300-18"></a>    <span class="fu">count</span>,</span>
<span id="cb1300-19"><a href="running-sql-queries-on-dataframes.html#cb1300-19"></a>    <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> species <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">count</span> <span class="kw">DESC</span>) <span class="kw">AS</span> <span class="fu">row_number</span></span>
<span id="cb1300-20"><a href="running-sql-queries-on-dataframes.html#cb1300-20"></a>  <span class="kw">FROM</span> pets</span>
<span id="cb1300-21"><a href="running-sql-queries-on-dataframes.html#cb1300-21"></a>)</span>
<span id="cb1300-22"><a href="running-sql-queries-on-dataframes.html#cb1300-22"></a></span>
<span id="cb1300-23"><a href="running-sql-queries-on-dataframes.html#cb1300-23"></a><span class="kw">SELECT</span></span>
<span id="cb1300-24"><a href="running-sql-queries-on-dataframes.html#cb1300-24"></a>  <span class="op">*</span></span>
<span id="cb1300-25"><a href="running-sql-queries-on-dataframes.html#cb1300-25"></a><span class="kw">FROM</span> animal_name_row_number</span>
<span id="cb1300-26"><a href="running-sql-queries-on-dataframes.html#cb1300-26"></a><span class="kw">WHERE</span> <span class="fu">row_number</span> <span class="op">&lt;=</span> <span class="dv">20</span></span>
<span id="cb1300-27"><a href="running-sql-queries-on-dataframes.html#cb1300-27"></a><span class="kw">ORDER</span> <span class="kw">BY</span> species <span class="kw">DESC</span>, <span class="fu">count</span> <span class="kw">DESC</span></span></code></pre></div>
<p>Voila, the tables generated by two different approaches look exactly the same, how cool is that! We can choose between the two depending on how we feel!</p>
<p>Let‚Äôs look at a slightly more complicated example, we want to know the 20 most popular names for dogs and cats combined. To do that, we need to structure the data in the long form for generating a Cleveland plot. Again we will do it using dplyr way first.</p>
<div class="sourceCode" id="cb1301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">seattlepets</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">animal_name</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/filter.html">filter</a></span> <span class="op">(</span><span class="va">species</span> <span class="op"><a href="https://rdrr.io/pkg/raster/man/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Dog"</span>, <span class="st">"Cat"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">animal_name</span>, <span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from<span class="op">=</span><span class="va">species</span>, values_from<span class="op">=</span><span class="va">count</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/mutate.html">mutate</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Dog</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">Dog</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Cat</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">Cat</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span>, <span class="va">animal_name</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/mutate.html">mutate</a></span><span class="op">(</span>row_number<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">row_number</span> <span class="op">&lt;=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/mutate.html">mutate</a></span><span class="op">(</span>total_count <span class="op">=</span> <span class="va">total</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Dog</span>, <span class="va">Cat</span>, <span class="va">total</span><span class="op">)</span>, names_to<span class="op">=</span><span class="st">"group_type"</span>, values_to<span class="op">=</span><span class="st">"count"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>

 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">animal_name</span>, <span class="va">total_count</span><span class="op">)</span>, <span class="va">count</span>, group<span class="op">=</span><span class="va">group_type</span>, color<span class="op">=</span><span class="va">group_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Animal Name"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span></code></pre></div>
<p>The cool thing about SQL engine is that it returns the result as a regular dplyr dataframe, which allows us to mix and match SQL queries and dplyr syntax. Here is a demonstration, where we calculate the total count of dog and cat names combined in SQL query, and leverage the <strong>pivot_longer</strong> function to structure the data for plotting.</p>
<div class="sourceCode" id="cb1302"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1302-1"><a href="running-sql-queries-on-dataframes.html#cb1302-1"></a><span class="co">--chunk options: {sql, connection=connection, output.var="total_pet_count"}</span></span>
<span id="cb1302-2"><a href="running-sql-queries-on-dataframes.html#cb1302-2"></a><span class="kw">WITH</span> pet_counts <span class="kw">AS</span></span>
<span id="cb1302-3"><a href="running-sql-queries-on-dataframes.html#cb1302-3"></a>(</span>
<span id="cb1302-4"><a href="running-sql-queries-on-dataframes.html#cb1302-4"></a>  <span class="kw">SELECT</span></span>
<span id="cb1302-5"><a href="running-sql-queries-on-dataframes.html#cb1302-5"></a>    animal_name, </span>
<span id="cb1302-6"><a href="running-sql-queries-on-dataframes.html#cb1302-6"></a>    species,</span>
<span id="cb1302-7"><a href="running-sql-queries-on-dataframes.html#cb1302-7"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> <span class="fu">count</span></span>
<span id="cb1302-8"><a href="running-sql-queries-on-dataframes.html#cb1302-8"></a>  <span class="kw">FROM</span> seattlepets</span>
<span id="cb1302-9"><a href="running-sql-queries-on-dataframes.html#cb1302-9"></a>  <span class="kw">WHERE</span> animal_name <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb1302-10"><a href="running-sql-queries-on-dataframes.html#cb1302-10"></a>    <span class="kw">AND</span> species <span class="kw">IN</span> (<span class="ot">"Dog"</span>, <span class="ot">"Cat"</span>)</span>
<span id="cb1302-11"><a href="running-sql-queries-on-dataframes.html#cb1302-11"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> animal_name, species</span>
<span id="cb1302-12"><a href="running-sql-queries-on-dataframes.html#cb1302-12"></a>)</span>
<span id="cb1302-13"><a href="running-sql-queries-on-dataframes.html#cb1302-13"></a></span>
<span id="cb1302-14"><a href="running-sql-queries-on-dataframes.html#cb1302-14"></a><span class="kw">SELECT</span></span>
<span id="cb1302-15"><a href="running-sql-queries-on-dataframes.html#cb1302-15"></a>  animal_name,</span>
<span id="cb1302-16"><a href="running-sql-queries-on-dataframes.html#cb1302-16"></a>  Cat,</span>
<span id="cb1302-17"><a href="running-sql-queries-on-dataframes.html#cb1302-17"></a>  Dog,</span>
<span id="cb1302-18"><a href="running-sql-queries-on-dataframes.html#cb1302-18"></a>  Cat <span class="op">+</span> Dog <span class="kw">AS</span> total,</span>
<span id="cb1302-19"><a href="running-sql-queries-on-dataframes.html#cb1302-19"></a>  <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">ORDER</span> <span class="kw">BY</span> Cat <span class="op">+</span> Dog <span class="kw">DESC</span>) <span class="kw">AS</span> <span class="fu">row_number</span></span>
<span id="cb1302-20"><a href="running-sql-queries-on-dataframes.html#cb1302-20"></a><span class="kw">FROM</span></span>
<span id="cb1302-21"><a href="running-sql-queries-on-dataframes.html#cb1302-21"></a>(</span>
<span id="cb1302-22"><a href="running-sql-queries-on-dataframes.html#cb1302-22"></a>  <span class="kw">SELECT</span></span>
<span id="cb1302-23"><a href="running-sql-queries-on-dataframes.html#cb1302-23"></a>    animal_name,</span>
<span id="cb1302-24"><a href="running-sql-queries-on-dataframes.html#cb1302-24"></a>    IFNULL(<span class="fu">SUM</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> species <span class="op">=</span> <span class="ot">"Cat"</span> <span class="cf">THEN</span> <span class="fu">count</span> <span class="cf">END</span>), <span class="dv">0</span>) <span class="kw">AS</span> Cat,</span>
<span id="cb1302-25"><a href="running-sql-queries-on-dataframes.html#cb1302-25"></a>    IFNULL(<span class="fu">SUM</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> species <span class="op">=</span> <span class="ot">"Dog"</span> <span class="cf">THEN</span> <span class="fu">count</span> <span class="cf">END</span>), <span class="dv">0</span>) <span class="kw">AS</span> Dog</span>
<span id="cb1302-26"><a href="running-sql-queries-on-dataframes.html#cb1302-26"></a>  <span class="kw">FROM</span> pet_counts</span>
<span id="cb1302-27"><a href="running-sql-queries-on-dataframes.html#cb1302-27"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> animal_name</span>
<span id="cb1302-28"><a href="running-sql-queries-on-dataframes.html#cb1302-28"></a>) p</span>
<span id="cb1302-29"><a href="running-sql-queries-on-dataframes.html#cb1302-29"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Cat <span class="op">+</span> Dog <span class="kw">DESC</span></span></code></pre></div>
<div class="sourceCode" id="cb1303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">total_pet_count</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">row_number</span> <span class="op">&lt;=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/mutate.html">mutate</a></span><span class="op">(</span>total_count <span class="op">=</span> <span class="va">total</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Dog</span>, <span class="va">Cat</span>, <span class="va">total</span><span class="op">)</span>, names_to<span class="op">=</span><span class="st">"group_type"</span>, values_to<span class="op">=</span><span class="st">"count"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sparklyr/man/pipe.html">%&gt;%</a></span>

 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">animal_name</span>, <span class="va">total_count</span><span class="op">)</span>, <span class="va">count</span>, group<span class="op">=</span><span class="va">group_type</span>, color<span class="op">=</span><span class="va">group_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Animal Name"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div id="lessons-learned" class="section level2">
<h2>
<span class="header-section-number">98.3</span> Lessons learned<a class="anchor" aria-label="anchor" href="#lessons-learned"><i class="fas fa-link"></i></a>
</h2>
<p>Writing SQL queries in R markdown is not as complicated as we thought. Although Knitr already provides support for the SQL engine, their documentation does not provide enough information for our use case, where we want to write SQL queries against the dataframes. It took us some time to realize that we could use an in-memory SqlLite database and import dataframes as tables, doing so allows us to use the SQL engine directly. We feel there is a missing gap in the documentation, which is the reason we created this tutorial to help others get up to speed.</p>
<p>In general, most of the dplyr functions can be reproduced in SQL queries, and vice versa. One could perform data transformation using either dplyr functions or SQL queries or the combination of both. However, there are certain things that are definitely easier to do depending on your background and preference (subjective opinions). For example, we feel doing joins and aliasing columns are much easier in SQL queries, whereas pivot operations are away easier and straightforward in dplyr.</p>
<p>We do want to re-iterate that writing SQL should not be a replacement of dplyr functions, but rather an alternative approach one could take. In addition, we acknowledge that there are certain drawbacks in the SQL approach.</p>
<ol style="list-style-type: decimal">
<li>SqlLite doesn‚Äôt support a few functions including pivot, unpivot, full outer join, and right join. (These functions are offered in other SQL dialects though e.g.¬†MSSQL)</li>
<li>For the intermediate results generated by the SQL chunk, we would have to import them as tables into the same in-mem database so we can use them in the subsequent SQL code chunks.</li>
<li>The SQL chunk doesn‚Äôt produce a paged table on its own. One would have to save the result as a dataframe and view it in a R chunk.</li>
</ol>
</div>
<div id="future-work" class="section level2">
<h2>
<span class="header-section-number">98.4</span> Future work<a class="anchor" aria-label="anchor" href="#future-work"><i class="fas fa-link"></i></a>
</h2>
<p>Given the limited time, we are happy with what we‚Äôve achieved, however, there are few things we would like to improve upon in the near future.</p>
<div id="missing-pagination-for-sql-engine-query-output" class="section level3">
<h3>
<span class="header-section-number">98.4.1</span> Missing pagination for sql engine query output<a class="anchor" aria-label="anchor" href="#missing-pagination-for-sql-engine-query-output"><i class="fas fa-link"></i></a>
</h3>
<p>We noticed that the table generated by sql engine doesn‚Äôt come with a pager, unlike the formatiting and pagination offered by dplyr by default. We looked through the options offered by the sql engine, but it doesn‚Äôt seem to support this feature. So we are planning to expand the table formatter in the existing sql engine to support pagination.</p>
</div>
<div id="sql-engine-for-dplyr-dataframes" class="section level3">
<h3>
<span class="header-section-number">98.4.2</span> sql engine for dplyr dataframes<a class="anchor" aria-label="anchor" href="#sql-engine-for-dplyr-dataframes"><i class="fas fa-link"></i></a>
</h3>
<p>Despite the success, we still feel that importing the tables to the in-mem database and passing the connection along is tedious and unncessary, in an idea world, we could just reference the dataframes in the environment directly in the SQL queries. We have explored this idea briefly by creating a new knitr engine named <em>eng_sql_local</em> based on the existing <em>eng_sql</em> implementation. The idea is summarized below,</p>
<ol style="list-style-type: decimal">
<li>we use a library called <a href="https://cran.r-project.org/web/packages/queryparser/">queryparser</a> to extract all the table references from the query</li>
<li>we get the corresponding dataframes by name from the knit_global environment</li>
<li>we import the dataframes into the dbplyr in-memory database</li>
<li>we invoke the existing <em>eng_sql</em> to run the query</li>
</ol>
<p>Here is a code snippet, and we also have the code in our <a href="https://github.com/ChaoPang/knitr/blob/90fcad9d6dfe842319d781315e5c79d4aa8d3bfd/R/engine.R#L653">own fork</a>.</p>
<div class="sourceCode" id="cb1304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># sql engine using dbplyr in-memory db</span>
<span class="va">eng_sql_local</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">options</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">query</span> <span class="op">=</span> <span class="fu">one_string</span><span class="op">(</span><span class="va">options</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>
  <span class="va">table_references</span> <span class="op">&lt;-</span> <span class="fu">queryparser</span><span class="fu">::</span><span class="fu">parse_query</span><span class="op">(</span><span class="va">query</span><span class="op">)</span><span class="op">$</span><span class="va">from</span>
  <span class="va">options</span><span class="op">$</span><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu">dbplyr</span><span class="fu">::</span><span class="fu"><a href="https://dbplyr.tidyverse.org/reference/memdb_frame.html">src_memdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">con</span>
  <span class="va">overwrite</span> <span class="op">&lt;-</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">options</span><span class="op">$</span><span class="va">overwrite</span><span class="op">)</span>, <span class="cn">FALSE</span>, <span class="va">options</span><span class="op">$</span><span class="va">overwrite</span><span class="op">)</span>

  <span class="va">output</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span><span class="op">{</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">table_references</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">{</span>
      <span class="va">table_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">table_references</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
      <span class="va">dataframe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">table_name</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_global.html">knit_global</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
      <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="op">!</span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExistsTable.html">dbExistsTable</a></span><span class="op">(</span><span class="va">options</span><span class="op">$</span><span class="va">connection</span>, <span class="va">table_name</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> <span class="va">overwrite</span><span class="op">)</span><span class="op">{</span>
        <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html">dbWriteTable</a></span><span class="op">(</span><span class="fu">dbplyr</span><span class="fu">::</span><span class="fu"><a href="https://dbplyr.tidyverse.org/reference/memdb_frame.html">src_memdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">con</span>, <span class="va">table_name</span>, <span class="va">dataframe</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span>
  <span class="op">}</span>,error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">e</span><span class="op">$</span><span class="va">message</span> <span class="op">&lt;-</span>
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">e</span><span class="op">$</span><span class="va">message</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"The table "</span>, <span class="va">table_name</span>, <span class="st">" doesn't exist in the global environment."</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,
            <span class="st">"Using the following command to set the dataframe in the global environment:"</span>,
            <span class="st">"env &lt;- knitr::knit_global()"</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"env$`"</span>, <span class="va">table_name</span>, <span class="st">"` &lt;- `"</span>, <span class="va">table_name</span>, <span class="st">"`"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,
            sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>
    <span class="va">e</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">output</span>, <span class="st">"error"</span><span class="op">)</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/engine_output.html">engine_output</a></span><span class="op">(</span><span class="va">options</span>, <span class="va">query</span>, <span class="fu">one_string</span><span class="op">(</span><span class="va">output</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">eng_sql</span><span class="op">(</span><span class="va">options</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>This has been tested successfully in our local environment (one would have to fork or clone our <a href="https://github.com/ChaoPang/knitr">repo</a>, build knitr locally to test out this new code block). However, the library <a href="https://cran.r-project.org/web/packages/queryparser/">queryparser</a> doesn‚Äôt handle the complex queries with Common Table Expression (CTE), we would have to implement our own queryparser using regular expression to identify table names in the query. Another problem we found with this custom sql engine is that it doesn‚Äôt support the syntax highlighting, while the existing sql engine does, we will try to fix this issue in the future.</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="joining-and-reshaping-in-r.html"><span class="header-section-number">97</span> Joining and reshaping in R</a></div>
<div class="next"><a href="tidyverse.html"><span class="header-section-number">99</span> TidyVerse</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#running-sql-queries-on-dataframes"><span class="header-section-number">98</span> Running Sql Queries on Dataframes</a></li>
<li><a class="nav-link" href="#motivation-8"><span class="header-section-number">98.1</span> Motivation</a></li>
<li>
<a class="nav-link" href="#sql-use-cases"><span class="header-section-number">98.2</span> SQL use cases</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#get-started"><span class="header-section-number">98.2.1</span> Get started</a></li>
<li><a class="nav-link" href="#complex-use-cases"><span class="header-section-number">98.2.2</span> Complex Use Cases</a></li>
</ul>
</li>
<li><a class="nav-link" href="#lessons-learned"><span class="header-section-number">98.3</span> Lessons learned</a></li>
<li>
<a class="nav-link" href="#future-work"><span class="header-section-number">98.4</span> Future work</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#missing-pagination-for-sql-engine-query-output"><span class="header-section-number">98.4.1</span> Missing pagination for sql engine query output</a></li>
<li><a class="nav-link" href="#sql-engine-for-dplyr-dataframes"><span class="header-section-number">98.4.2</span> sql engine for dplyr dataframes</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jtr13/cc21fall2/blob/main/running_sql_queries_on_dataframes.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jtr13/cc21fall2/edit/main/running_sql_queries_on_dataframes.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>EDAV Fall 2021 Tues/Thurs Community Contributions</strong>" was written by . It was last built on 2021-11-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
